<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>TESTE DE CONTROLE - FINANÇAS</title>
    <style>
        /* CSS EMBUTIDO PARA NÃO DEPENDER DE ARQUIVOS EXTERNOS */
        body { font-family: sans-serif; background: #f0f2f5; margin: 0; display: flex; }
        aside { width: 280px; background: #0f172a; color: white; height: 100vh; padding: 20px; position: fixed; }
        main { margin-left: 280px; padding: 40px; flex-grow: 1; }
        
        .form-box { background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px; }
        input { width: 100%; margin-bottom: 10px; padding: 8px; box-sizing: border-box; }
        button { width: 100%; padding: 10px; cursor: pointer; background: #3b82f6; color: white; border: none; border-radius: 5px; }
        
        /* OVERLAY DE BLOQUEIO */
        #bloqueio {
            position: fixed; inset: 0; background: rgba(0,0,0,0.95); color: white;
            display: none; align-items: center; justify-content: center; z-index: 9999;
            flex-direction: column;
        }
        .card-auth { background: #1e293b; padding: 30px; border-radius: 15px; width: 300px; text-align: center; }
        .status-vencido { color: #ff4444; font-weight: bold; }
    </style>
</head>
<body>

    <div id="bloqueio">
        <div class="card-auth">
            <h2>CADASTRO NECESSÁRIO</h2>
            <p>Você atingiu o limite de 2 lançamentos gratuitos.</p>
            <input type="email" id="email" placeholder="E-mail">
            <input type="password" id="senha" placeholder="Senha">
            <button onclick="fazerLogin()">CADASTRAR E LOGAR</button>
        </div>
    </div>

    <aside>
        <h2 id="msg-user">Modo Visitante</h2>
        <div class="form-box">
            <label>Descrição</label><input type="text" id="desc">
            <label>Valor</label><input type="number" id="valor">
            <button onclick="adicionar()">LANÇAR</button>
        </div>
        <br>
        <button id="btn-sair" style="display:none; background:#ef4444;" onclick="sair()">SAIR DA CONTA</button>
    </aside>

    <main>
        <h1>Meus Lançamentos</h1>
        <div id="contador" style="background: white; padding: 10px; margin-bottom: 20px;">Lançamentos: 0 / 2</div>
        <table border="1" width="100%" style="background: white; border-collapse: collapse;">
            <thead>
                <tr><th>Descrição</th><th>Valor</th><th>Status</th></tr>
            </thead>
            <tbody id="tabela"></tbody>
        </table>
    </main>

    <script>
        // Limpa tudo para o teste ser do zero
        let dados = JSON.parse(localStorage.getItem('teste_db')) || [];
        let logado = localStorage.getItem('teste_logado') === 'true';

        function adicionar() {
            // Lógica de bloqueio no 3º item
            if (!logado && dados.length >= 2) {
                document.getElementById('bloqueio').style.display = 'flex';
                return;
            }

            const desc = document.getElementById('desc').value;
            const valor = document.getElementById('valor').value;

            if(!desc || !valor) return alert("Preencha os campos");

            dados.push({ desc, valor: parseFloat(valor) });
            localStorage.setItem('teste_db', JSON.stringify(dados));
            render();
            
            document.getElementById('desc').value = '';
            document.getElementById('valor').value = '';
        }

        function fazerLogin() {
            const e = document.getElementById('email').value;
            const s = document.getElementById('senha').value;
            if(e && s) {
                localStorage.setItem('teste_logado', 'true');
                logado = true;
                document.getElementById('bloqueio').style.display = 'none';
                render();
            }
        }

        function sair() {
            localStorage.removeItem('teste_logado');
            location.reload();
        }

        function render() {
            const tabela = document.getElementById('tabela');
            const cont = document.getElementById('contador');
            const msg = document.getElementById('msg-user');
            const btnSair = document.getElementById('btn-sair');

            tabela.innerHTML = dados.map(d => `<tr><td>${d.desc}</td><td>R$ ${d.valor}</td><td class="status-vencido">Pendente</td></tr>`).join('');
            cont.innerText = `Lançamentos: ${dados.length} / 2`;
            
            if(logado) {
                msg.innerText = "Logado com Sucesso!";
                btnSair.style.display = 'block';
                document.getElementById('bloqueio').style.display = 'none';
            }
        }

        render();
    </script>
</body>
</html>
